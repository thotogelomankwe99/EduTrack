<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack - Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(107, 114, 128, 0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        .header-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #7c3aed;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
            color: #111827;
        }

        .app-subtitle {
            font-size: 12px;
            color: #6B7280;
        }

        .admin-info {
            text-align: center;
        }

        .admin-name {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .role-info {
            font-size: 14px;
            color: #6B7280;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .datetime-badge {
            background: rgba(124, 58, 237, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(124, 58, 237, 0.1);
            color: #7c3aed;
            font-weight: 500;
            font-size: 14px;
        }

        .settings-btn {
            padding: 8px;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .settings-btn:hover {
            background: rgba(107, 114, 128, 0.05);
        }

        /* Navigation Styles */
        nav {
            background: white;
            border-bottom: 1px solid rgba(107, 114, 128, 0.1);
            position: sticky;
            top: 72px;
            z-index: 30;
        }

        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 1rem 0.75rem;
            font-size: 14px;
            font-weight: 500;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            color: #6B7280;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: #7c3aed;
        }

        .tab-btn.active {
            border-bottom-color: #7c3aed;
            color: #7c3aed;
        }

        /* Main Content */
        main {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        @media (max-width: 768px) {
            .grid-cols-3,
            .grid-cols-4,
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 1024px) {
            .lg-grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            .lg-grid-cols-3 {
                grid-template-columns: 1fr 2fr;
            }
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .stat-card {
            border-left: 4px solid;
        }

        .stat-card.primary {
            border-left-color: #7c3aed;
        }

        .stat-card.success {
            border-left-color: #059669;
        }

        .stat-card.danger {
            border-left-color: #DC2626;
        }

        .stat-card.warning {
            border-left-color: #D97706;
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .stat-info p:first-child {
            color: #6B7280;
            font-size: 14px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 30px;
            font-weight: bold;
            color: #111827;
        }

        .stat-value.success {
            color: #047857;
        }

        .stat-value.danger {
            color: #DC2626;
        }

        .stat-value.warning {
            color: #D97706;
        }

        .stat-icon {
            background: rgba(124, 58, 237, 0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 24px;
        }

        .stat-icon.success {
            background: rgba(5, 150, 105, 0.1);
        }

        .stat-icon.danger {
            background: rgba(220, 38, 38, 0.1);
        }

        .stat-icon.warning {
            background: rgba(217, 119, 6, 0.1);
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #7c3aed;
            color: white;
        }

        .btn-primary:hover {
            background: #6d28d9;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: #DC2626;
            color: white;
        }

        .btn-danger:hover {
            background: #B91C1C;
        }

        .btn-warning {
            background: #D97706;
            color: white;
        }

        .btn-warning:hover {
            background: #B45309;
        }

        .btn-secondary {
            background: rgba(5, 150, 105, 0.2);
            color: #047857;
        }

        .btn-secondary:hover {
            background: rgba(5, 150, 105, 0.3);
        }

        .btn-full {
            width: 100%;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(107, 114, 128, 0.3);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px 8px;
            font-size: 14px;
            font-weight: 600;
            color: #6B7280;
            border-bottom: 1px solid rgba(107, 114, 128, 0.2);
        }

        td {
            padding: 12px 8px;
            border-bottom: 1px solid rgba(107, 114, 128, 0.1);
        }

        tr:hover {
            background: #f8fafc;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-present {
            background: rgba(37, 99, 235, 0.2);
            color: #2563EB;
        }

        .status-absent {
            background: rgba(220, 38, 38, 0.2);
            color: #DC2626;
        }

        .status-active {
            background: rgba(5, 150, 105, 0.2);
            color: #047857;
        }

        .status-inactive {
            background: rgba(107, 114, 128, 0.2);
            color: #6B7280;
        }

        /* QR Code Section */
        .qr-display {
            text-align: center;
        }

        .qr-code {
            width: 192px;
            height: 192px;
            margin: 0 auto 1rem;
            background: white;
            border: 2px solid rgba(107, 114, 128, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .qr-code .icon {
            font-size: 60px;
            margin-bottom: 8px;
        }

        /* Student List */
        .student-item,
        .teacher-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .student-info,
        .teacher-info {
            display: flex;
            align-items: center;
        }

        .student-avatar,
        .teacher-avatar {
            width: 40px;
            height: 40px;
            background: rgba(124, 58, 237, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #7c3aed;
        }

        .student-name,
        .teacher-name {
            font-weight: 500;
            color: #111827;
        }

        .student-details,
        .teacher-details {
            font-size: 14px;
            color: #6B7280;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6B7280;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 1rem;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(17, 24, 39, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            width: 100%;
            max-width: 448px;
            margin: 1rem;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6B7280;
        }

        .modal-close:hover {
            color: #111827;
        }

        /* Notifications */
        .notifications {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }

        .notification {
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 8px;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #7c3aed;
            color: white;
        }

        .notification.warning {
            background: #059669;
            color: #111827;
        }

        .notification.error {
            background: #DC2626;
            color: white;
        }

        .notification.info {
            background: #111827;
            color: white;
        }

        /* Footer */
        footer {
            background: white;
            border-top: 1px solid rgba(107, 114, 128, 0.2);
            margin-top: 3rem;
        }

        .footer-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3,
        .footer-section h4 {
            margin-bottom: 1rem;
            color: #111827;
        }

        .footer-section p,
        .footer-section li {
            color: #6B7280;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section a {
            color: #6B7280;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-section a:hover {
            color: #7c3aed;
        }

        /* Chart Placeholder */
        .chart-placeholder {
            height: 256px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            color: #6B7280;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .admin-info {
                display: none;
            }

            .app-subtitle {
                display: none;
            }

            .lg-grid-cols-3 {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mt-3 {
            margin-top: 0.75rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-x-2 > * + * {
            margin-left: 0.5rem;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <!-- Left side: Logo and App Name -->
            <div class="logo-section">
                <div class="logo">
                <img src="EduTrack.png" style="width:40px; height:40px;">
                </div>
                <div>
                    <h1 class="app-title">EduTrack</h1>
                    <p class="app-subtitle">Admin Dashboard</p>
                </div>
            </div>

            <!-- Center: Admin Info -->
            <div class="admin-info">
                <h2 class="admin-name" id="adminName">Loading...</h2>
                <p class="role-info" id="roleInfo">System Administrator</p>
            </div>

            <!-- Right side: Date/Time and Settings -->
            <div class="header-right">
                <div class="datetime-badge">
                    <span id="currentDateTime">ğŸ“… Loading...</span>
                </div>
                <button onclick="showSettings()" class="settings-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav>
        <div class="nav-container">
            <button onclick="switchTab('overview')" class="tab-btn active">
                ğŸ“Š Overview
            </button>
            <button onclick="switchTab('teachers')" class="tab-btn">
                ğŸ‘¨â€ğŸ« Manage Teachers
            </button>
            <button onclick="switchTab('students')" class="tab-btn">
                ğŸ‘¥ All Students
            </button>
            <button onclick="switchTab('attendance')" class="tab-btn">
                ğŸ“ˆ Attendance Reports
            </button>
            <button onclick="switchTab('system')" class="tab-btn">
                âš™ï¸ System Settings
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <!-- Quick Stats Cards -->
            <div class="grid grid-cols-4 mb-6">
                <div class="card stat-card primary">
                    <div class="stat-header">
                        <div>
                            <p>Total Teachers</p>
                            <p class="stat-value" id="totalTeachers">0</p>
                        </div>
                        <div class="stat-icon">
                            <span>ğŸ‘¨â€ğŸ«</span>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card success">
                    <div class="stat-header">
                        <div>
                            <p>Total Students</p>
                            <p class="stat-value success" id="totalStudents">0</p>
                        </div>
                        <div class="stat-icon success">
                            <span>ğŸ‘¥</span>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card warning">
                    <div class="stat-header">
                        <div>
                            <p>Active Classes</p>
                            <p class="stat-value warning" id="activeClasses">0</p>
                        </div>
                        <div class="stat-icon warning">
                            <span>ğŸ«</span>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card danger">
                    <div class="stat-header">
                        <div>
                            <p>Today's Attendance</p>
                            <p class="stat-value danger" id="todayAttendance">0%</p>
                        </div>
                        <div class="stat-icon danger">
                            <span>ğŸ“Š</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Charts -->
            <div class="grid lg-grid-cols-2">
                <div class="card">
                    <h3 style="font-size: 18px; font-weight: bold; color: #111827; margin-bottom: 1rem;">School Attendance Overview</h3>
                    <div class="chart-placeholder">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 1rem;">ğŸ“Š</div>
                            <p>School-wide Attendance Chart</p>
                            <p style="font-size: 12px; color: #6B7280;" id="attendanceChartText">Loading data...</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="font-size: 18px; font-weight: bold; color: #111827; margin-bottom: 1rem;">Teacher Performance</h3>
                    <div class="chart-placeholder">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 1rem;">ğŸ“ˆ</div>
                            <p>Teacher Activity Overview</p>
                            <p style="font-size: 12px; color: #6B7280;" id="trendsText">Track teacher performance</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Teachers Tab -->
        <div id="teachers-tab" class="tab-content">
            <div class="grid lg-grid-cols-2">
                <!-- Add Teacher Form -->
                <div class="card">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                        <span style="margin-right: 8px;">â•</span> Add New Teacher
                    </h2>
                    
                    <form onsubmit="addTeacher(event)" class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" id="teacherName" required class="form-input" placeholder="e.g., Sarah Johnson">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="teacherEmail" required class="form-input" placeholder="e.g., sarah@school.edu">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Class/Grade</label>
                            <select id="teacherClass" class="form-select">
                                <option value="9A">Grade 9A</option>
                                <option value="9B">Grade 9B</option>
                                <option value="10A">Grade 10A</option>
                                <option value="10B">Grade 10B</option>
                                <option value="11A">Grade 11A</option>
                                <option value="11B">Grade 11B</option>
                                <option value="12A">Grade 12A</option>
                                <option value="12B">Grade 12B</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Subject (Optional)</label>
                            <input type="text" id="teacherSubject" class="form-input" placeholder="e.g., Mathematics">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-full">
                            Add Teacher
                        </button>
                    </form>
                </div>

                <!-- Teachers List -->
                <div class="card">
                    <div class="flex items-center justify-between mb-4">
                        <h2 style="font-size: 20px; font-weight: bold; color: #111827;">
                            <span style="margin-right: 8px;">ğŸ‘¨â€ğŸ«</span> All Teachers
                        </h2>
                        <span style="font-size: 14px; color: #6B7280;" id="teacherCount">Loading...</span>
                    </div>
                    
                    <div id="teachersList" style="max-height: 384px; overflow-y: auto;">
                        <div class="empty-state">
                            <div class="icon">ğŸ‘¨â€ğŸ«</div>
                            <p>Loading teachers...</p>
                            <p style="font-size: 14px;">Please wait while we load teacher data</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Students Tab -->
        <div id="students-tab" class="tab-content">
            <div class="card">
                <div class="flex items-center justify-between mb-4">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827;">
                        <span style="margin-right: 8px;">ğŸ‘¥</span> All Students
                    </h2>
                    <div class="flex gap-2">
                        <select id="classFilter" class="form-select" style="width: auto;">
                            <option value="all">All Classes</option>
                            <option value="9A">Grade 9A</option>
                            <option value="9B">Grade 9B</option>
                            <option value="10A">Grade 10A</option>
                            <option value="10B">Grade 10B</option>
                            <option value="11A">Grade 11A</option>
                            <option value="11B">Grade 11B</option>
                            <option value="12A">Grade 12A</option>
                            <option value="12B">Grade 12B</option>
                        </select>
                        <button onclick="exportStudentData()" class="btn btn-primary btn-small">
                            Export Data
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Class</th>
                                <th>Teacher</th>
                                <th>Attendance Rate</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="allStudentsTable">
                            <tr>
                                <td colspan="6">
                                    <div class="empty-state">
                                        <div class="icon">ğŸ‘¥</div>
                                        <p>Loading students...</p>
                                        <p style="font-size: 14px;">Please wait while we load student data</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Attendance Reports Tab -->
        <div id="attendance-tab" class="tab-content">
            <div class="grid lg-grid-cols-2">
                <div class="card">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                        <span style="margin-right: 8px;">ğŸ“Š</span> Generate Report
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Report Type</label>
                            <select id="reportType" class="form-select">
                                <option value="daily">Daily Attendance</option>
                                <option value="weekly">Weekly Summary</option>
                                <option value="monthly">Monthly Report</option>
                                <option value="class">Class Performance</option>
                                <option value="teacher">Teacher Performance</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <div class="flex gap-2">
                                <input type="date" id="startDate" class="form-input">
                                <input type="date" id="endDate" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Class/Teacher (Optional)</label>
                            <select id="reportFilter" class="form-select">
                                <option value="all">All Classes/Teachers</option>
                            </select>
                        </div>
                        
                        <button onclick="generateReport()" class="btn btn-primary btn-full">
                            Generate Report
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                        <span style="margin-right: 8px;">ğŸ“ˆ</span> Recent Reports
                    </h2>
                    
                    <div id="recentReports" style="max-height: 384px; overflow-y: auto;">
                        <div class="empty-state">
                            <div class="icon">ğŸ“Š</div>
                            <p>No reports generated yet</p>
                            <p style="font-size: 14px;">Generate your first report to see it here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Settings Tab -->
        <div id="system-tab" class="tab-content">
            <div class="grid lg-grid-cols-2">
                <div class="card">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                        <span style="margin-right: 8px;">ğŸ«</span> School Settings
                    </h2>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">School Name</label>
                            <input type="text" id="schoolName" class="form-input" value="Springfield High School">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Academic Year</label>
                            <select id="academicYear" class="form-select">
                                <option>2024</option>
                                <option>2023</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Attendance Threshold (%)</label>
                            <input type="number" id="attendanceThreshold" class="form-input" value="75" min="0" max="100">
                        </div>
                        <button onclick="updateSchoolSettings()" class="btn btn-primary btn-full">
                            Save Settings
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                        <span style="margin-right: 8px;">âš™ï¸</span> System Management
                    </h2>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Database Backup</label>
                            <button onclick="createBackup()" class="btn btn-secondary btn-full">
                                Create Backup
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">System Health</label>
                            <div style="background: #f8fafc; padding: 12px; border-radius: 8px;">
                                <div class="flex justify-between mb-2">
                                    <span>Database</span>
                                    <span class="status-badge status-active">Healthy</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>Authentication</span>
                                    <span class="status-badge status-active">Healthy</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Storage</span>
                                    <span class="status-badge status-active">Healthy</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="startWalkthrough()" class="btn btn-secondary btn-full mb-4">
                            ğŸ¯ Admin Tutorial
                        </button>
                        <button onclick="logout()" class="btn btn-danger btn-full">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Walkthrough Overlay -->
    <div id="walkthroughOverlay" class="overlay">
        <div class="modal">
            <div class="text-center">
                <div style="font-size: 48px; margin-bottom: 1rem;" id="walkthroughIcon">ğŸ‰</div>
                <h3 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 8px;" id="walkthroughTitle">Welcome to EduTrack Admin!</h3>
                <p style="color: #6B7280; margin-bottom: 1.5rem;" id="walkthroughText">Let's get you started with the admin dashboard.</p>
                
                <div class="flex items-center justify-between">
                    <button onclick="skipWalkthrough()" style="color: #6B7280; background: none; border: none; cursor: pointer;">Skip Tour</button>
                    <div class="flex gap-2">
                        <button onclick="prevStep()" id="prevBtn" class="btn" style="background: rgba(107, 114, 128, 0.2); color: #6B7280;" disabled>Previous</button>
                        <button onclick="nextStep()" id="nextBtn" class="btn btn-primary">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <!-- Company Info -->
            <div class="footer-section">
                <div class="flex items-center gap-2 mb-4">
                    <div class="logo" style="width: 32px; height: 32px;">
                       <img src="EduTrack.png" style="width:40px; height:40px;">
                    </div>
                    <h3 style="font-size: 18px; font-weight: bold;">EduTrack Admin</h3>
                </div>
                <p style="margin-bottom: 1rem;">Administrative dashboard for managing teachers, students, and attendance across your school.</p>
                <p style="font-size: 12px;">Â© 2024 EduTrack. All rights reserved.</p>
            </div>

            <!-- Quick Links -->
            <div class="footer-section">
                <h4 style="font-weight: 600;">Admin Resources</h4>
                <ul>
                    <li><a href="#">User Management Guide</a></li>
                    <li><a href="#">Reporting Documentation</a></li>
                    <li><a href="#">System Administration</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>

            <!-- Contact Info -->
            <div class="footer-section">
                <h4 style="font-weight: 600;">Admin Support</h4>
                <div>
                    <p>ğŸ“§ admin-support@edutrack.co.za</p>
                    <p>ğŸ“ +27 11 123 4567 (Ext. 2)</p>
                    <p>ğŸ•’ Mon-Fri: 8:00 AM - 5:00 PM</p>
                    <p style="font-size: 12px; margin-top: 1rem;">Administrative support for system configuration and user management.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <script>
        // Supabase configuration
        let supabase;
        let currentUser = {};
        let teachers = [];
        let students = [];
        let currentTab = 'overview';
        let walkthroughStep = 0;
        let isFirstTime = localStorage.getItem('edutrack_admin_first_time') !== 'false';

        // Initialize Supabase
        function initializeSupabase() {
            try {
                const supabaseUrl = 'https://gzfhxldtvlrnhjujkoad.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd6Zmh4bGR0dmxybmhqdWprb2FkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3ODU0ODIsImV4cCI6MjA3NDM2MTQ4Mn0.KgDkP8R4mTneQg3KEyRreaFUFvE3Tr8fhtJ8d4eTXkE';
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                return true;
            } catch (error) {
                showNotification('Failed to initialize application', 'error');
                return false;
            }
        }

        // Check authentication and load user data
        async function checkAuthentication() {
            if (!supabase) initializeSupabase();
            
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                showNotification('Please log in to access the dashboard', 'error');
                setTimeout(() => {
                    window.location.href = 'registration.html';
                }, 2000);
                return false;
            }

            // Verify user role and get user data
            const { data: user, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', session.user.id)
                .single();

            if (error || !user) {
                showNotification('User not found in database', 'error');
                await logout();
                return false;
            }

            if (user.role !== 'admin') {
                showNotification('Access denied. Admin role required.', 'error');
                setTimeout(() => {
                    window.location.href = 'registration.html';
                }, 2000);
                return false;
            }

            currentUser = user;
            updateUserInterface();
            loadTeachers();
            loadAllStudents();
            
            return true;
        }

        // Update UI with user data
        function updateUserInterface() {
            document.getElementById('adminName').textContent = currentUser.full_name;
            document.getElementById('roleInfo').textContent = `${currentUser.role} â€¢ ${currentUser.school_name}`;
            
            // Update chart texts
            document.getElementById('attendanceChartText').textContent = `Data for ${currentUser.school_name}`;
            document.getElementById('trendsText').textContent = `Teacher performance for ${currentUser.school_name}`;
        }

        // Load teachers from Supabase
        async function loadTeachers() {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('role', 'teacher')
                    .eq('school_name', currentUser.school_name)
                    .order('full_name');

                if (error) throw error;

                teachers = data || [];
                updateTeachersList();
                updateStats();
                
            } catch (error) {
                console.error('Error loading teachers:', error);
                showNotification('Error loading teachers', 'error');
            }
        }

        // Load all students from Supabase
        async function loadAllStudents() {
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('school_name', currentUser.school_name)
                    .order('name');

                if (error) throw error;

                students = data || [];
                updateAllStudentsTable();
                updateStats();
                
            } catch (error) {
                console.error('Error loading students:', error);
                showNotification('Error loading students', 'error');
            }
        }

        // Add teacher to Supabase
        async function addTeacher(event) {
            event.preventDefault();
            
            const name = document.getElementById('teacherName').value;
            const email = document.getElementById('teacherEmail').value;
            const className = document.getElementById('teacherClass').value;
            const subject = document.getElementById('teacherSubject').value;
            
            try {
                // First create auth user
                const { data: authData, error: authError } = await supabase.auth.admin.createUser({
                    email: email,
                    password: 'TempPassword123!', // Should be changed on first login
                    email_confirm: true,
                    user_metadata: {
                        full_name: name,
                        role: 'teacher',
                        school_name: currentUser.school_name,
                        class_name: className,
                        subject: subject
                    }
                });

                if (authError) throw authError;

                // Then add to users table
                const { data, error } = await supabase
                    .from('users')
                    .insert([
                        {
                            id: authData.user.id,
                            full_name: name,
                            email: email,
                            role: 'teacher',
                            school_name: currentUser.school_name,
                            class_name: className,
                            subject: subject,
                            created_at: new Date().toISOString()
                        }
                    ])
                    .select();

                if (error) throw error;

                teachers.push(data[0]);
                updateTeachersList();
                updateStats();
                
                // Reset form
                document.getElementById('teacherName').value = '';
                document.getElementById('teacherEmail').value = '';
                document.getElementById('teacherSubject').value = '';
                
                showNotification(`${name} added successfully! Temporary password sent.`, 'success');
                
            } catch (error) {
                console.error('Error adding teacher:', error);
                showNotification('Error adding teacher', 'error');
            }
        }

        // Remove teacher from Supabase
        async function removeTeacher(teacherId) {
            if (!confirm('Are you sure you want to remove this teacher?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('users')
                    .delete()
                    .eq('id', teacherId);

                if (error) throw error;

                teachers = teachers.filter(t => t.id !== teacherId);
                updateTeachersList();
                updateStats();
                showNotification('Teacher removed successfully', 'warning');
                
            } catch (error) {
                console.error('Error removing teacher:', error);
                showNotification('Error removing teacher', 'error');
            }
        }

        // Update statistics on the overview tab
        function updateStats() {
            const totalTeachers = teachers.length;
            const totalStudents = students.length;
            const activeClasses = [...new Set(teachers.map(t => t.class_name))].length;
            const todayAttendance = students.length > 0 ? 
                Math.round((students.filter(s => s.status === 'present').length / students.length) * 100) : 0;

            document.getElementById('totalTeachers').textContent = totalTeachers;
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('activeClasses').textContent = activeClasses;
            document.getElementById('todayAttendance').textContent = `${todayAttendance}%`;
        }

        // Update teachers list
        function updateTeachersList() {
            const container = document.getElementById('teachersList');
            const countElement = document.getElementById('teacherCount');
            
            countElement.textContent = `${teachers.length} teacher${teachers.length !== 1 ? 's' : ''}`;
            
            if (teachers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ‘¨â€ğŸ«</div>
                        <p>No teachers added yet</p>
                        <p style="font-size: 14px;">Add your first teacher using the form</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teachers.map(teacher => `
                <div class="teacher-item">
                    <div class="teacher-info">
                        <div class="teacher-avatar">
                            <span>${teacher.full_name.split(' ').map(n => n[0]).join('')}</span>
                        </div>
                        <div>
                            <p class="teacher-name">${teacher.full_name}</p>
                            <p class="teacher-details">${teacher.class_name} â€¢ ${teacher.email}</p>
                        </div>
                    </div>
                    <button onclick="removeTeacher('${teacher.id}')" style="color: #DC2626; background: none; border: none; cursor: pointer;">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        // Update all students table
        function updateAllStudentsTable() {
            const tbody = document.getElementById('allStudentsTable');
            const classFilter = document.getElementById('classFilter').value;
            
            let filteredStudents = students;
            if (classFilter !== 'all') {
                filteredStudents = students.filter(s => s.grade === classFilter);
            }
            
            if (filteredStudents.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="icon">ğŸ‘¥</div>
                                <p>No students found</p>
                                <p style="font-size: 14px;">${classFilter !== 'all' ? 'Try selecting a different class' : 'Students will appear here once added'}</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredStudents.map(student => {
                const teacher = teachers.find(t => t.class_name === student.grade) || {};
                const attendanceRate = Math.floor(Math.random() * 40) + 60; // Mock data
                
                return `
                    <tr>
                        <td>
                            <div class="student-info">
                                <div class="student-avatar">
                                    <span>${student.name.split(' ').map(n => n[0]).join('')}</span>
                                </div>
                                <div>
                                    <p class="student-name">${student.name}</p>
                                    <p class="student-details">ID: ${student.id}</p>
                                </div>
                            </div>
                        </td>
                        <td>${student.grade}</td>
                        <td>${teacher.full_name || 'Unassigned'}</td>
                        <td>${attendanceRate}%</td>
                        <td>
                            <span class="status-badge ${student.status === 'present' ? 'status-present' : 'status-absent'}">
                                ${student.status}
                            </span>
                        </td>
                        <td>
                            <button onclick="viewStudentDetails('${student.id}')" class="btn btn-small" style="background: rgba(107, 114, 128, 0.2); color: #6B7280;">
                                View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Export student data
        function exportStudentData() {
            showNotification('Export feature coming soon!', 'info');
        }

        // Generate report
        function generateReport() {
            showNotification('Report generation feature coming soon!', 'info');
        }

        // Update school settings
        function updateSchoolSettings() {
            showNotification('School settings updated successfully!', 'success');
        }

        // Create backup
        function createBackup() {
            showNotification('Database backup created successfully!', 'success');
        }

        // View student details
        function viewStudentDetails(studentId) {
            showNotification('Student details feature coming soon!', 'info');
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = `ğŸ“… ${now.toLocaleDateString('en-ZA', options)}`;
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to selected button
            event.target.classList.add('active');
            
            currentTab = tabName;
        }

        // Walkthrough steps
        const walkthroughSteps = [
            {
                icon: 'ğŸ‰',
                title: 'Welcome to EduTrack Admin!',
                text: `Welcome, ${currentUser.full_name}! Let's get you started with the admin dashboard.`
            },
            {
                icon: 'ğŸ‘¨â€ğŸ«',
                title: 'Manage Teachers',
                text: 'Use the "Manage Teachers" tab to add, view, and remove teachers from your school.'
            },
            {
                icon: 'ğŸ‘¥',
                title: 'View All Students',
                text: 'The "All Students" tab gives you an overview of all students across all classes.'
            },
            {
                icon: 'ğŸ“Š',
                title: 'Generate Reports',
                text: 'Create detailed attendance reports for classes, teachers, or the entire school.'
            },
            {
                icon: 'âš™ï¸',
                title: 'System Settings',
                text: 'Configure school-wide settings and monitor system health in the "System Settings" tab.'
            },
            {
                icon: 'ğŸš€',
                title: 'You\'re All Set!',
                text: 'Start by adding teachers, then they can begin managing their classes. Good luck!'
            }
        ];

        // Walkthrough functions
        function startWalkthrough() {
            walkthroughStep = 0;
            // Update first step with user's name
            walkthroughSteps[0].text = `Welcome, ${currentUser.full_name}! Let's get you started with the admin dashboard.`;
            document.getElementById('walkthroughOverlay').classList.add('active');
            updateWalkthroughStep();
        }

        function nextStep() {
            if (walkthroughStep < walkthroughSteps.length - 1) {
                walkthroughStep++;
                updateWalkthroughStep();
            } else {
                finishWalkthrough();
            }
        }

        function prevStep() {
            if (walkthroughStep > 0) {
                walkthroughStep--;
                updateWalkthroughStep();
            }
        }

        function updateWalkthroughStep() {
            const step = walkthroughSteps[walkthroughStep];
            document.getElementById('walkthroughIcon').textContent = step.icon;
            document.getElementById('walkthroughTitle').textContent = step.title;
            document.getElementById('walkthroughText').textContent = step.text;
            
            document.getElementById('prevBtn').disabled = walkthroughStep === 0;
            document.getElementById('nextBtn').textContent = walkthroughStep === walkthroughSteps.length - 1 ? 'Finish' : 'Next';
        }

        function skipWalkthrough() {
            finishWalkthrough();
        }

        function finishWalkthrough() {
            document.getElementById('walkthroughOverlay').classList.remove('active');
            localStorage.setItem('edutrack_admin_first_time', 'false');
            showNotification(`Welcome to EduTrack Admin, ${currentUser.full_name}!`, 'success');
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Settings functions
        function showSettings() {
            switchTab('system');
            // Find and click the settings tab button
            const settingsBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => btn.textContent.includes('System'));
            if (settingsBtn) {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                settingsBtn.classList.add('active');
            }
        }

        // Logout function
        async function logout() {
            if (supabase) {
                await supabase.auth.signOut();
            }
            window.location.href = 'registration.html';
        }

        // Real-time auth state listener
        function setupAuthListener() {
            if (supabase) {
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_OUT') {
                        window.location.href = 'registration.html';
                    }
                });
            }
        }

        // Class filter change handler
        document.getElementById('classFilter').addEventListener('change', function() {
            updateAllStudentsTable();
        });

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            initializeSupabase();
            setupAuthListener();
            
            const isAuthenticated = await checkAuthentication();
            
            if (isAuthenticated) {
                updateDateTime();
                setInterval(updateDateTime, 1000);
                
                if (isFirstTime) {
                    setTimeout(() => startWalkthrough(), 1000);
                }
            } else {
                // Hide content if not authenticated
                document.querySelector('main').style.display = 'none';
                document.querySelector('nav').style.display = 'none';
            }
        });
    </script>
</body>
</html>